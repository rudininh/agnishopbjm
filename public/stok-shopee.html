<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Admin - Stok Shopee</title>
    <link rel="stylesheet" href="./assets/style.css" />
</head>

<body>
    <div id="sidebar"></div>

    <div class="main-content">
        <div id="header"></div>

        <div class="dashboard-container">
            <div class="dashboard-card" id="stok-box">
                <h1>Stok Shopee</h1>
                <p>Daftar stok produk dari toko Shopee Anda.</p>

                <div class="status-box" style="overflow-x:auto;">
                    <hr>
                    <h3>Daftar Produk Shopee</h3>
                    <button id="btnLoadItems" class="btn-shopee">üì¶ TAMPILKAN PRODUK</button>

                    <table id="produkTable" border="1" cellpadding="8"
                        style="margin-top:10px; border-collapse: collapse; width:100%;">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Produk</th>
                                <th>SKU</th>
                                <th>Stok</th>
                                <th>Harga</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                </div>
            </div>
        </div>

        <div id="footer"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Tombol GET TOKEN sudah ada, tambahkan tombol LOAD ITEMS
            const interval = setInterval(() => {
                const btnShopee = document.getElementById('btnShopee');
                const btnItems = document.getElementById('btnLoadItems');

                if (btnShopee && btnItems) {
                    clearInterval(interval);

                    // Tombol GET TOKEN
                    btnShopee.addEventListener('click', async () => {
                        btnShopee.innerText = 'Mengambil token...';
                        btnShopee.disabled = true;
                        try {
                            const res = await fetch('/api/get-token');
                            const data = await res.json();
                            alert('‚úÖ Token berhasil diambil:\n' + JSON.stringify(data, null, 2));
                        } catch (err) {
                            alert('‚ùå Gagal: ' + err.message);
                        }
                        btnShopee.innerText = 'GET TOKEN SHOPEE';
                        btnShopee.disabled = false;
                    });

                    // Tombol LOAD ITEMS
                    btnItems.addEventListener('click', async () => {
                        btnItems.innerText = 'Memuat produk...';
                        btnItems.disabled = true;
                        try {
                            const res = await fetch('/api/get-items');
                            const data = await res.json();

                            const tbody = document.querySelector('#produkTable tbody');
                            tbody.innerHTML = '';

                            data.items.forEach(item => {
                                const row = `
              <tr>
                <td>${item.no}</td>
                <td>${item.nama}</td>
                <td>${item.sku}</td>
                <td>${item.stok}</td>
                <td>${item.harga}</td>
              </tr>
            `;
                                tbody.innerHTML += row;
                            });
                        } catch (err) {
                            alert('‚ùå Gagal memuat produk: ' + err.message);
                        }
                        btnItems.innerText = 'üì¶ TAMPILKAN PRODUK';
                        btnItems.disabled = false;
                    });
                }
            }, 200);
        });

    </script>
</body>

</html>