<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Admin</title>
    <link rel="stylesheet" href="./assets/style.css" />
</head>

<body>
    <div id="sidebar"></div>

    <div class="main-content">
        <div id="header"></div>

        <div class="dashboard-container">
            <div class="dashboard-card">
                <h1>Stok Shopee</h1>
                <p>Daftar stok produk dari toko Shopee Anda.</p>


                <div class="status-box">
                    <table border="1" cellspacing="0" cellpadding="8" style="width:100%; border-collapse: collapse;">
                        <thead style="background:#f2f2f2;">
                            <tr>
                                <th>No</th>
                                <th>Nama Produk</th>
                                <th>SKU</th>
                                <th>Stok</th>
                                <th>Harga</th>
                            </tr>
                        </thead>
                        <tbody id="stok-table">
                            <tr>
                                <td>1</td>
                                <td>Contoh Produk 1</td>
                                <td>SKU123</td>
                                <td>25</td>
                                <td>Rp50.000</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>Contoh Produk 2</td>
                                <td>SKU456</td>
                                <td>10</td>
                                <td>Rp30.000</td>
                            </tr>
                        </tbody>
                    </table>

                </div>

            </div>
        </div>




        <div id="footer"></div>
    </div>

    <script>
        // Fungsi untuk load komponen HTML eksternal
        async function loadComponent(id, file) {
            const res = await fetch(file);
            const html = await res.text();
            document.getElementById(id).innerHTML = html;
        }

        // Load sidebar, header, footer
        loadComponent('sidebar', './component/sidebar.html');
        loadComponent('header', './component/header.html');
        loadComponent('footer', './component/footer.html');

        // Cek login
        if (!localStorage.getItem("loggedIn")) {
            window.location.href = "/";
        }

        document.addEventListener("DOMContentLoaded", async () => {
            const box = document.querySelector(".dashboard-card");
            box.innerHTML = "<p>üîÑ Mengambil data stok dari Shopee...</p>";

            try {
                const res = await fetch("/api/get-stok");
                const data = await res.json();

                let html = `
      <h2>Stok Shopee</h2>
      <p>Daftar stok produk dari toko Shopee Anda.</p>
      <table border="1" cellspacing="0" cellpadding="8" style="width:100%; border-collapse:collapse;">
        <tr><th>No</th><th>Nama Produk</th><th>SKU</th><th>Stok</th><th>Harga</th></tr>
    `;

                data.items.forEach((item, i) => {
                    html += `
        <tr>
          <td>${i + 1}</td>
          <td>${item.item_name}</td>
          <td>${item.item_sku || '-'}</td>
          <td>${item.stock}</td>
          <td>Rp${item.price}</td>
        </tr>`;
                });
                html += "</table>";
                box.innerHTML = html;

            } catch (err) {
                box.innerHTML = `<p style="color:red;">‚ùå Gagal ambil data: ${err.message}</p>`;
            }
        });


    </script>
</body>

</html>